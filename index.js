/*let tiposMalware = [
    {
        nombre: "Ransomware",
        caracteristicas: ["Toma el control del dispositivo","No permite el acceso a archivos del dispositivo","Solicita un rescate para el acceso a la informacion"],
        medidas: ["Evitar ejecutar archivos, links o utilizar dispositivos USB de dudosa procedencia","Observar el remitente del mensaje o correo electrónico"],
        gradoPertenencia: 0
    },
    {
        nombre: "Spyware",
        caracteristicas: ["Ha sido instalado sin consentimiento del usuario","Se han instalado archivos adicionales al que he descargado","Rastrea o monitorea mi actividad"],
        medidas: ["Evitar descarga de aplicaciones de sitios no oficiales o software pirata","Ignorar anuncios y ventanas emergentes durante la navegación"],
        gradoPertenencia: 0
    },
    {
        nombre: "Keyloggers",
        caracteristicas: ["Registra las pulsaciones del teclado","Actua sin consentimiento del usuario"],
        medidas: ["Mantener equipo actualizado","Evitar ejecutar archivos, links o utilizar dispositivos USB de dudosa procedencia"],
        gradoPertenencia: 0
    }
];


let problemas = ["Toma el control del dispositivo","Ha sido instalado sin consentimiento del usuario","No permite el acceso a archivos del dispositivo"];
*/

//diagnosticar();

function diagnosticar(tiposMalware,problemas, cuadroModal) {

    tiposMalware = tiposMalware.map(malware => {//Iteramos cada tipo de malware

        problemas.forEach(problema => {
    
            malware.caracteristicas.forEach(description => {//Iteramos cada caracteristica del malware
                if(problema.toLowerCase() == description.toLocaleLowerCase()){
                    malware.gradoPertenencia += 1;
                }
            });
    
        });

        return malware;

    });   

    //cuadroModal.classList.remove('hide');
    
    graficarPorcentajes(problemas.length, tiposMalware, cuadroModal);

}

function graficarPorcentajes(numeroProblemas, malwares, cuadroModal) {
    //cuadroModal.classList.remove('hide');
    let coincidencias = [];

    malwares.forEach(malware => {

        let medidas = malware.medidas;
        let nombre = malware.nombre;
        let porcentaje =  parseFloat(((malware.gradoPertenencia * 100)/numeroProblemas).toPrecision(3)); 

        let nuevoMalware = {
            nombre: nombre,
            porcentaje: porcentaje,
            medidas: medidas
        };

        coincidencias.push(nuevoMalware);
        //console.log("Nombre: " + malware.nombre + " Porcentaje: " + ((malware.gradoPertenencia * 100)/numeroProblemas).toPrecision(3));
    });


    let mayor = 0;
    let nombreModal="";
    let medidasModal = [];
    for(let i = 0; i < coincidencias.length; i++){
        mayor = parseFloat(coincidencias[i].porcentaje);
        for(let j = 0; j < coincidencias.length; j++){
            let test = parseFloat(coincidencias[j].porcentaje);
            let nombreAnything = coincidencias[j].nombre;
            let medidasGet = coincidencias[j].medidas;
            if(test >= mayor){
                mayor = test;
                nombreModal = nombreAnything;
                medidasModal = medidasGet;
            }
        }
    }

    console.log(mayor);  
    console.log(nombreModal); 
    console.log(medidasModal);


    cuadroModal.classList.remove('hide');//Mostramos el cuadro

    cuadroModal.querySelector('#nameShow').innerText = nombreModal;
    cuadroModal.querySelector('#porcentajeShow').innerText = mayor + " %";
    let medidasContainer = document.querySelector('#medidas');

    medidasContainer.innerHTML = "";

    medidasModal.forEach(medida => {
        let li = document.createElement('li');
        li.innerText = medida;
        medidasContainer.appendChild(li);
    });
}